\section{Gossip Protocol}

\subsection{Design}

Describe gossip protocol here.

\subsection{Gossip Results}

Insert gossip performance analysis here.

\subsection{Recovery Mode}

An alternative gossip protocol that is orthogonal to the protocol described above is 
what we have dubbed ``Recovery Mode'' or ``Emergency Mode''. Basically, we
want to prevent a situation in which a seeder leaves and takes unique pieces
with it, leaving the other nodes unable to finish. This gossip protocol obviously
cannot force seeders to stay, but it can help seeders learn when it is safe to
leave without stranding the rest of the torrent. 

There are many ways such a protocol could be structured. We wanted the lowest
overhead protocol possible, so we chose a method based on a simple OR operation
at each node. Basically, each exchange round a node will check its peers bitfields
and make sure that all of the pieces of the file are available within its peer
set. If not, the node will broadcast a WAIT message to all of its peers. In addition, it will
also broadcast a WAIT message to all of its peers if any of those peers sent a 
WAIT message since the last exchange round. So, the condition to send a WAIT message 
can be thought of as an OR operation. To prevent cycling, a timestamp is placed
on WAIT messages and each node will keep track of the most recent timestamp they have seen. 
Nodes will then only forward messages if the message's timestamp is newer than their most 
recent observed timestamp.

Similar to the leechers, seeders will also receive and forward the WAIT messages. If the 
seed is altruistic enough to want to prevent the torrent from dying when it leaves,
then the seed will send a LEAVE message to its peers when it wants to leave. The LEAVE
message tells the peers to no longer take into account the seeder's pieces when computing
whether or not to send a WAIT message. After the LEAVE message is sent, the seeder will
wait for an additional exchange round and make sure that it receives no new WAIT messages
generated by either its peers or another node in the network. When it receives no WAIT
messages for an exchange round, the seeder is then free to leave without putting the 
swarm in jeopardy of failing. 

The overhead for this protocol is much lower than the previous gossip
system because each node will only send a single message to its peers
each round, so the total number of messages per 10 seconds is PxN. Therefore,
this protocol is a low-overhead mechanism for allowing seeders to know when it is safe
to leave. One could imagine a GUI for a BitTorrent client could have an indicator widget
to alert the end user for the seeder node if WAIT messages are being received or not. As
mentioned above, the recovery mode is orthogonal to the previous gossip
protocol and therefore both could be run at the same time within a swarm.
